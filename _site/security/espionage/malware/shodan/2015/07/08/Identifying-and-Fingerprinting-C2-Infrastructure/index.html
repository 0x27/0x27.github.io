<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Tracking down spies C&C infrastructure for shits and giggles &middot; 0x27.me
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/naringu.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/form.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="./public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Mozilla RSS" href="feed.category.xml">
  </head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48740529-1', 'auto');
  ga('send', 'pageview');

</script>


<body class="theme-6dd">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <img width="125" height="125" alt="A photo of me" src="/images/head.jpeg">
    <p>Home of the 0x27 Finger Discount</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">Category Index</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/media/">Media</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/talks/">Talks</a>
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/0x27">GitHub</a>
    <a class="sidebar-nav-item" href="https://twitter.com/info_dox">Twitter</a>
    <a class="sidebar-nav-item" href="https://www.linkedin.com/in/darren-martyn-8411b149">LinkedIn</a>
    <span class="sidebar-nav-item">Version 2.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">0x27.me</a>
            <small>Home of the 0x27 Finger Discount</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Tracking down spies C&C infrastructure for shits and giggles</h1>
  <span class="post-date">08 Jul 2015</span>
  <p>This is a quick post to splainz the methodology behind how we were able to make fingerprints for the Hacking Team and Equation Group C&amp;C infrastructure allowing remote identification of their servers, as shown in <a href="https://github.com/0x27/TheItalianJob">The Italian Job</a> and <a href="https://github.com/0x27/EquationSmasher">Equation Smasher</a> releases on Github.</p>

<p>Myself and <a href="https://twitter.com/_ta0">March</a>, the rootkit wizard, have been at this kind of thing for quite some time, and have had a great deal of success in enumerating and identifying C&amp;C infrastructure based on various oddities in how they present themselves. A fine example of this was in our <a href="http://insecurety.net/?p=729">Hunting Red October</a> work prior (which resulted in the “asdic.pl” and “sonar.py” scripts).</p>

<p>Basically, here is a TL;DR on how you, too, can hunt down shitbag spies and other such nasties.</p>

<h2 id="step-1-get-samples-of-the-malware-andor-ips-of-some-still-active-cc-servers">Step 1: Get samples of the malware and/or IP’s of some still active C&amp;C servers.</h2>
<p>This is often trivial. Once someone publishes a report, or you get some nasty malware, identify the C&amp;C server (run it in a sandbox or whatever and sniff those sweet, sweet pacotes).</p>

<h2 id="step-2-muck-about-with-the-cc-server">Step 2: Muck about with the C&amp;C server.</h2>
<p>Next up, do a portscan of the C&amp;C server(s). Of particular interest is the callback port. You want to fiddle with that port/service a bit and see if it returns a “weird” or unique banner or response, that you can chuck into <a href="https://shodan.io">shodan</a> and try identify similar servers.</p>

<h2 id="step-3-fuck-with-related-hosts">Step 3: Fuck with related hosts</h2>
<p>The third step is fairly simple. Once you have a list of hosts that also act in the same fashion and “smell” the same (much of this is based on scientific jiggerypokery and general faffing about with them), you portscan those and look for further similarities. Most oftentimes, C&amp;C infrastructure is “cloned” across hosts, so they all will be set up in the same fashion.</p>

<h2 id="optional-step-4-scan-the-planet">Optional Step 4: Scan the Planet</h2>
<p>Optionally, here you can scan the entire planet with masscan or zmap looking for similar hosts that Shodan’s crawler might not have hit yet. This gives you a nice list of IP’s to compare against netflow logs and also to bang into online sandboxes/AV things to see if theres other samples out there calling back, so you can gather more information and link samples/campaigns together.</p>

<h2 id="optional-step-5-hack-the-planet">Optional Step 5: Hack the Planet</h2>
<p>I have NOT engaged in this hypothetical step, and cannot legally advocate for it, however others such as <a href="https://malware.lu/assets/files/articles/RAP002_APT1_Technical_backstage.1.0.pdf">Malware.lu in the case of APT-1</a> (warning: PDF link) have done so. Somehow procure a copy of the C&amp;C software in question, fuzz the shit out of it, find some bugs, and own the spying bastards, preferably uninfecting their victims and burning their infrastructure to the ground. I include this step for completeness only, and to point out that there is some recourse to be had.</p>

<p>Good sources of <del>DDoS numbers</del> IP addresses/C&amp;C hosts to initially target for, er, interrogation are reports from <a href="https://citizenlab.org/">Citizen Lab</a> and AV vendors on the latest and lamest surveillance campaigns. Also, because some espionage campaigns are cheapskates, obtaining copies of widely (ab)used RAT software sold/used by <del>APT’s</del> script kiddies (such as Poison Ivy/BlackShades/DarkComet) and analysing those examples is also a fine way to find new, exciting fingerprints (and vulnerabilities…) to go forth and ruin some attackers days.</p>

<p>Further note: If the malware uses a web based (say, written in PHP) web panel, you might be able to fingerprint on HTTP titles or figure out a google-dork or other way of identifying the panel. Think of web panels as vulnerable webapps and apply the same thinking to locating and finding vulnerabilities in them. Quite often the bit of the web panel (the “gate”) that the implant calls back to fails miserably at sanitizing inputs to databases or file outputs, so there are often some gloriously exploitable bugs there. See the <a href="https://malware.lu/articles/2012/05/21/analysis-and-pownage-of-herpesnet-botnet.html">Herpesnet teardown/ownage by malware.lu</a> for some ideas on that :)</p>

<p>Have fun, and be safe. Remember kids - when fucking with C&amp;C’s/malware, practice safe hex and wear your balaclavas!</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/security/iot/botnets/mirai/2016/10/24/On-The-Supposed-Cost-of-IoT-Botnets/">
            On the supposed 'Cost' of IoT Botnets... 
            <small>24 Oct 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/vpn/privacy/security/2015/11/26/Practical-Exploitation-of-Portfail/">
            Practical Exploitation of the VPN 'PortFail' IP Leak against Torrent Users.
            <small>26 Nov 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/chemistry/science/writeups/2015/09/12/Synthesis-of-Nitroacetanilide-from-Acetanilide/">
            Synthesis of p-Nitroacetanilide from Acetanilide
            <small>12 Sep 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = '';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = '';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

    <div align="center" class="footer">
        <a href="https://github.com/ariestiyansyah/naringu" target="_blank" title="naringu">Naringu</a>  is designed by Rizky Ariestiyansyah<br />Copyright © 2017 <br>
    </div>
  </body>
</html>

